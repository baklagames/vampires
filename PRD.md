# PRD vFinal — Mobile Web (PWA) Vampire Stealth Game (EN)

## 0) Hard Rules (Strict)
1. All tunable gameplay parameters live only in config.
2. Config format: local YAML (MVP).
3. No gameplay magic numbers in code (only DS tokens allowed for layout/spacing).
4. Any balance change must be done by editing YAML only, without code changes.

## 1) Executive Summary
- Platform: mobile-first web (responsive), PWA-friendly.
- Genre: top-down stealth/survival action, short sessions, light meta-progression.
- Setting: a small town (open world), expandable later.
- Player: a vampire (gender selection) hunting humans for blood.
- Core dynamic:
  - Day: sunlight is lethal in direct sun; more humans (more witnesses); police reacts faster.
  - Night: no sun; fewer humans; police presence x2.
  - Local panic: consequences are localized around incidents (panic bubble), not city-wide.
  - Death: respawn at the vampire castle, in a coffin.

## 2) Vision / USP / Elevator Pitch

**Elevator pitch**
You are a vampire in a small town. By day you survive by routing through shadows among crowds and fast police responses. By night you roam freely without sunlight, but humans are scarce and patrols are doubled. Mistakes create localized panic: nearby people flee and call police to that specific neighborhood. If you die, you wake up in a coffin at the castle and hunt again.

**USP (MVP-fixed)**
1. Tap-Intent Hunt: one-hand control (tap-to-move + tap-to-target).
2. Local Panic Bubble: panic and police remain local to the incident area.
3. Sun-as-a-Map + Day/Night: daytime becomes a “shadow maze”, nighttime shifts hunting economy.

## 3) Target Audience
- Mobile casual–midcore, pixel-art fans, stealth enjoyers, “one more run” loop players.
- Motivations: stealth mastery, risk/reward, progression, vampire collection (post-MVP).

## 4) Design Pillars
1. Simple, intuitive UI/UX: minimal buttons, maximum predictability.
2. Thumb-first: primary actions at the bottom.
3. Readability first: sun/shade/danger/heat must be instantly readable.
4. Local consequences: panic and police are area-based, not global.
5. Small map, deep loop: small world with dense systems.

Not in MVP: multiplayer, advanced realtime lighting, huge world, vehicles, cutscenes, heavy RPG inventory.

## 5) Core Gameplay Loops

**Moment-to-moment (seconds):**
Assess → tap move → tap target (red ring) → approach → bite/feed → witness? → local panic → police arrives to area → hide/escape

**Session loop (5–10 min):**
1–3 feedings → rising local risk → leave area / enter interior / wait for phase change → upgrade → repeat

**Meta loop:**
Castle upgrades + (future) unlocking new vampires (4 locked cards in MVP UI).

## 6) Player Character, Choice, Name

### 6.1 Vampire selection (MVP)
- 2 playable: Vampire Female, Vampire Male
- 4 locked: grey cards “Locked / Coming soon”

### 6.2 Player name
- Randomly generated by default
- Manual input allowed, strictly [A-Za-z0-9]
- Validation (length/regex/behavior) is YAML-config only

## 7) World & Locations

### 7.1 Town (MVP)
- One open-world town, 3 districts:
  - Residential (houses/yards, more shade)
  - Main Street (plaza/shops, high visibility)
  - Industrial/Alleys (cover, stronger patrols at night)
- 6–10 enterable buildings (simple interiors)

### 7.2 Vampire Castle (Base)
- Separate scene:
  - Coffin (respawn)
  - Upgrades
  - Return to town

## 8) NPCs

### 8.1 Humans (types + parameters)

**Visual types:**
- men, women, kids, grandmas, grandpas

**Gameplay rules:**
- grandmas/grandpas: slower, worse blood quality
- kids: faster, higher blood quality
- adults: baseline

All speed/blood quality multipliers are YAML-configurable.

### 8.2 Police
- Patrol + responders
- Night has x2 police via config multiplier

### 8.3 Vampires
- Player (MVP)
- Castle NPCs (atmosphere, no complex AI in MVP)

## 9) Mechanics (MVP)

### 9.1 Controls (Strict)
- Tap-to-move: tap ground → walk to point (pathfinding).
- Tap-to-target: tap human → select target.
- On select: red ring flash for a short time (150–250ms, from config) → then soft outline/marker remains.
- Cancel: tap empty ground or tap target again.

**Bottom actions (max 2–3):**
- Bite/Action (contextual)
- Escape (cooldown)
- Hide (contextual, if available)

### 9.2 Day/Night Cycle (Must-have)

**Phases:** Day → Dusk → Night → Dawn
- Day: sun lethal; more humans; more witnesses; faster police response
- Night: no sun; fewer humans; police x2
- Dusk/Dawn: UI warnings + visual cues

### 9.3 Sun / Shade
- Daytime sunlit tiles deal ramping damage until death.
- Safe: shade / indoors / castle.

### 9.4 Stealth / Detection (simplified but strong)

**NPC states:** Calm → Suspicious → Alarmed → Panic

**Triggers:** line of sight, distance, suspicious actions (attack/feeding), noise.

### 9.5 Local Panic Bubble (Not global)

Incident creates panic area:
- center = incident location
- radius = R (YAML)
- only NPCs inside bubble:
  - flee / scream / attempt police call
  - increase local heat
  - police spawns/responds in that area, not across the map

### 9.6 Feeding / Combat
- reach bite range → Bite
- during feeding player is vulnerable to detection
- feeding can be interrupted (tap away) → less blood, less risk

### 9.7 Damage / Death / Respawn
- bullets + sun reduce health
- death → castle → coffin
- penalty/progress persistence is configurable (MVP default: lose part of current blood, keep upgrades)

## 10) Art Direction
- Style: pixel-retro (8-bit or 16-bit)
- MVP recommendation: 16-bit (better mobile readability; cleaner overlays)
- Characters: small/chibi, clear silhouettes (kids vs elders)
- UI: pixel-clean, minimal clutter

## 11) UX/UI

**HUD always shows:**
- time of day + countdown
- heat level
- health & blood
- 2–3 bottom buttons

**Onboarding (30–60s):** tap move, tap target, sun kills by day, local panic, run/hide.

## 12) Design System (Required Base)

### 12.1 Tokens
- Spacing: 4 / 8 / 12 / 16 / 24
- Radius: 8 / 12
- Typography (pixel): 12 / 14 / 16 / 20
- Color roles: Background, Surface, TextPrimary, TextSecondary, Accent, Danger, Warning, Success

### 12.2 UI Components
- PixelCard
- ButtonPrimary
- ButtonSecondary
- ButtonIcon
- BottomActionBar
- HUDChip
- ProgressBar
- HeatIndicator
- TimeOfDayIndicator
- Toast
- ModalSheet
- ListItem
- TextField (validation states)
- ToggleSwitch
- Slider (if needed)
- TooltipHelp (“?”)

### 12.3 Game Overlays
- TargetRingFlash (duration from config)
- TargetOutline
- PanicAreaIndicator
- SunDangerOverlay
- TapMarker (optional)

### 12.4 Scene Blocks (Game modules)
- TownScene
- InteriorScene
- CastleScene
- NPCSpawner
- DayNightController
- SunShadeMap
- DetectionController
- PanicBubbleController
- PoliceResponseController
- PathfindingGrid
- SaveSystem

**Rule:** every screen must be built only from DS components (no custom ad-hoc UI).

## 13) Config System (YAML knobs) — MVP Structure

```yaml
game:
  version: "0.1"
  locale: "en"

player:
  name:
    random:
      enabled: true
      length: 8
      charset: "A-Za-z0-9"
    manualInput:
      enabled: true
      regex: "^[A-Za-z0-9]{3,12}$"
      onInvalid: "reject"   # reject|strip|replace
      replaceChar: "_"      # used if replace

controls:
  tapToMove:
    enabled: true
  tapToTarget:
    enabled: true
  targetRing:
    flashMs: 200
  tapMarker:
    enabled: false

dayNight:
  cycle:
    totalSeconds: 420
    daySeconds: 160
    duskSeconds: 40
    nightSeconds: 160
    dawnSeconds: 60
  npcDensity:
    dayMultiplier: 1.0
    nightMultiplier: 0.45

sun:
  enabled: true
  damagePerSecond: 12
  graceMs: 150
  safeZones:
    indoors: true
    castle: true

panic:
  bubble:
    radiusTiles: 10
    durationSeconds: 25
  witness:
    callPoliceDelaySeconds: 2.0
    panicSpreadWithinBubble: true

heat:
  levels: 6
  decay:
    enabled: true
    secondsToStartDecay: 6
    decayPerSecond: 0.6

humans:
  base:
    walkSpeed: 1.0
    bloodQuality: 1.0
  variants:
    adultMale:
      speedMultiplier: 1.0
      bloodQualityMultiplier: 1.0
    adultFemale:
      speedMultiplier: 1.0
      bloodQualityMultiplier: 1.0
    kid:
      speedMultiplier: 1.35
      bloodQualityMultiplier: 1.25
    grandma:
      speedMultiplier: 0.75
      bloodQualityMultiplier: 0.80
    grandpa:
      speedMultiplier: 0.75
      bloodQualityMultiplier: 0.80

police:
  enabled: true
  spawn:
    baseCount: 2
    responseCountPerHeat: 1
    nightMultiplier: 2.0
  vision:
    dayRangeTiles: 9
    nightRangeTiles: 6
  damage:
    bulletDamage: 10
    fireRatePerSecond: 0.8

feeding:
  bite:
    rangeTiles: 1.0
    baseDurationSeconds: 2.4
    interruptible: true
  reward:
    baseBloodGain: 20

performance:
  maxActiveNpcs:
    town: 40
    interior: 12
```

## 14) Tech & Architecture (Mobile Web)

### 14.1 Engine / Rendering
- Recommended: Phaser (fast MVP: scenes, sprites, tilemaps, input, lightweight physics)
- Tilemap + sprite-based rendering
- Overlays (sun/panic/target) as separate cheap layers

### 14.2 Pathfinding
- Grid-based A*
- Limit recalculation (cache; recompute only when target changes)

### 14.3 Lighting/Shadows (MVP)
- No realtime ray lighting
- “Sunlit/shade” is tile tagging + simple overlay
- Dawn/Dusk changes overlay intensity based on phase

### 14.4 Save/Storage
- Local: IndexedDB (or localStorage for simplified MVP)
- PWA cache for assets
- Accounts/cloud/leaderboards post-MVP (optional)

### 14.5 Analytics
- Minimal event telemetry; local queue + deferred sending

## 15) Exact Screen List (Wireframe-level) + DS Components

Format: Screen ID — Title → Purpose / Layout / Built from DS

**S0 — Boot / Loading**
- Purpose: load config + assets
- Layout: center logo + progress; bottom version
- DS: ProgressBar, HUDChip, PixelCard (optional)

**S1 — Main Menu**
- Layout: title; stacked buttons (Play, Settings, Credits); optional PWA hint
- DS: PixelCard, ButtonPrimary, ButtonSecondary, HUDChip

**S2 — Character Select + Name**
- Layout: header “Choose your vampire”; 2-col grid (2 playable + 4 locked); name block with TextField; optional Randomize; bottom Continue
- DS: PixelCard, ListItem (traits row) or HUDChip row, TextField, ButtonIcon, Toast, ButtonPrimary, TooltipHelp/ModalSheet (optional)

**S3 — Castle Base (Coffin Hub)**
- Layout: “Castle”; coffin visual; summary bars; bottom actions (Return to Town, Upgrades)
- DS: PixelCard, ProgressBar, BottomActionBar, ButtonPrimary/Secondary

**S4 — Upgrades**
- Layout: scroll list (name/desc/cost/buy); bottom Back
- DS: ListItem, PixelCard, ButtonPrimary, ButtonSecondary, Toast

**S5 — Settings**
- Layout: controls/accessibility/debug; bottom Back
- DS: PixelCard, ToggleSwitch, Slider (optional), ListItem, ButtonSecondary, HUDChip

**S6 — Town Gameplay (Main Scene)**
- HUD: TimeOfDayIndicator + countdown (top-left), HeatIndicator (top-right), blood/health bars, world canvas, BottomActionBar (Bite/Action, Escape, Hide), overlays
- DS: TimeOfDayIndicator, HeatIndicator, ProgressBar, BottomActionBar, HUDChip, Toast, TargetRingFlash/Outline, PanicAreaIndicator, SunDangerOverlay, TapMarker (optional)

**S7 — Interior Gameplay**
- Layout: same HUD + Exit (icon/button)
- DS: same as S6 + ButtonSecondary/ButtonIcon (Exit)

**S8 — Pause Menu (overlay)**
- Layout: bottom sheet: Resume, Settings, Return to Castle (if allowed), Quit
- DS: ModalSheet, ButtonPrimary/Secondary, ListItem

**S9 — Death Screen (overlay)**
- Layout: “You died”, cause (sun/police), Continue → Castle
- DS: PixelCard, ButtonPrimary, HUDChip

**S10 — Credits**
- Layout: scroll + back
- DS: PixelCard, ButtonSecondary

**Navigation (Strict):**
- S0 → S1
- S1 → S2 → S3 → S6
- S6 ↔ S7
- S6 → S8
- S6 → S9 → S3
- S3 → S4
- S1 → S5
- S1 → S10

## 16) MVP Content (Minimum but playable)
- 3 districts + 6–10 interiors
- Human variants (5) + police
- Day/Night + sun/shade + local panic
- Castle base + upgrades (10–15)
- Optional 2–3 items/skills (Escape/Smoke/Lure), keep minimal

## 17) Production Plan (Fast)
- Sprint 1: controls + target ring + basic humans + town scene
- Sprint 2: feeding + detection + local panic bubble
- Sprint 3: police response + damage/death + castle respawn
- Sprint 4: day/night + sun/shade + UI polish + upgrades + PWA + analytics

## 18) Acceptance Criteria (MVP Done)
- Tap-to-move/tap-to-target feels perfect on mobile
- Red target ring flash duration is read from YAML
- Day/Night changes NPC density + sun rules
- Night police count is exactly x2 via YAML multiplier
- Panic is strictly local (bubble); police responds within bubble area
- Death → castle → coffin
- 2 playable vampires + 4 locked cards
- Name: random default + manual input strictly [A-Za-z0-9]
- All tunables adjusted via YAML only (no code edits)
- Every screen built strictly from DS components
